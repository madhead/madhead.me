---
title: GitHub Actions are not perfect (for Actions developers)
date: 2021-03-29T09:00:00+03:00
tags:
  - github actions
  - rant
---

I would say that GitHub Actions are the pinnacle of evolution of CI/CD services.

Although they are really fun to use in your projects, I will target another aspect in this article.
I would like to speak about a few flaws in GitHub Actions architecture that make developing reusable Actions not as comfortable as it could be.

<!--more-->

Do you remember building and testing your code with custom scripts (`make` in the best case scenario) on a PC in the darkest corner of your office, labeled with a sticker saying something like "do not shut down"?
I know some projects still do that.
Then we saw Jenkins, who standardised a lot of things, but the jobs were still configured manually.
Then, the pipelines-as-code approach emerged, we saw Jenkins Pipelines and dozen of CI/CD services, like Travis and GitLab CI/CD, bloomed.
Yeah, I know that Travis is actually a coeval of Jenkins, but it's just an example.

And finally we have GitHub Actions.
It is a good old pipelines-as-code solution, but deeply integrated with SCM server.
Contrary to the elder services, who were code-centric, GitHub Actions are repository-centric.
And considering how good GitHub repositories are—I mean all those neat features like https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests/about-pull-requests[PRs], https://docs.github.com/en/github/administering-a-repository/about-releases[Releases], https://docs.github.com/en/github/managing-your-work-on-github/about-issues[Issues], https://docs.github.com/en/github/building-a-strong-community/about-wikis[Wikis], https://github.com/features/project-management/[Projects], and https://docs.github.com/en/packages/learn-github-packages/about-github-packages[Packages]—this should be enough to sell GitHub Actions to any sane developer!

But they also have the https://github.com/marketplace[Marketplace] and this is insane!

Before the Marketplace there was no easy way to share and reuse a piece of build logic.

Jenkins plugins were too difficult to create, share and reuse (trust me, I published https://github.com/jenkinsci/doktor-plugin[one]).
You have no choice but Java to author them.
Then you have to understand some of Jenkins internals and philosophy, like `hudson.Extension` (it's a shit with a looong history, my friend) descriptors, actions, steps, file access API, and Apache Commons Jelly (BTW it's abandoned).
Jenkins API is a cursed legacy pile!
Then you deal with https://www.jenkins.io/doc/developer/plugin-development/dependencies-and-class-loading[classloaders], and it may be a showstopper if you came from JS.
Finally, you publish your plugin on https://plugins.jenkins.io[plugins.jenkins.io] and users ask their admins to install it.

GitLab CI/CD has an `include` keyword that allows you to reuse pieces of YAML in different projects, but there is no good way to make those pieces visible and searchable to others.
There are templates maintained by GitLab, but to find the link you'll have to read the docs really carefully
Here is the link as a complement: https://gitlab.com/gitlab-org/gitlab/-/tree/master/lib/gitlab/ci/templates[GitLab CI/CD templates].
I am not sure if GitLab team will address this in future, probably this "social aspect" is not on their backlog at all.
As a result, you'll be limited in reusing your own templates, or, as a best case scenario, your company's templates.

This blog is build with GitLab CI/CD and it https://gitlab.com/madhead.me/madhead.me/-/blob/master/.gitlab-ci.yml[takes about 30 lines of YAML] to install https://gohugo.io[Hugo], build the site, and publish it to GitHub Pages.
All this steps are implemented from the ground up with shell commands like `apt install hugo` and so on.
Here is a functionally equivalent piece of GitHub Actions workflow:

[source, yml]
----
- uses: peaceiris/actions-hugo@v2
  with:
    hugo-version: '0.81.0'
- run: hugo
- uses: peaceiris/actions-gh-pages@v3
  with:
    github_token: ${{ secrets.GITHUB_TOKEN }}
    publish_dir: ./public
----

It's like 4-6 times shorter, and, more important, it's crystal clear: I'm using Hugo to build the blog and I'm publishing the result to the GitHub Pages.

All credits go to https://github.com/peaceiris[Shohei Ueda] who shared these reusable actions with me.
Well, anyone can use `peaceiris/actions-hugo` in their workflows for free!
And they don't need to know Shohei Ueda to reuse his work, just search for "Hugo" actions https://github.com/marketplace?type=actions&query=Hugo[on the Marketplace] and choose the one they like the most (probably, by the number of stars):

{{< figure src="//storage.googleapis.com/madheadme-static/posts/imperfect-github-actions/001.png" class="align-center" >}}

And there are thousands of Actions waiting to be reused already, and the number link:../semver-utils[is] link:../read-java-properties[growing].

Are you bored already, because it was only the introduction?
